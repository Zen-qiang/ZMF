"use strict";var Weixin=function(){var i=function(){return"micromessenger"==navigator.userAgent.toLowerCase().match(/micromessenger/i)},s=function(t,e){i()&&(e=$.extend({url:"http://101.132.119.127:5566/zmf/getConfig?url="+encodeURIComponent(location.href.split("#")[0]),type:"GET",cache:!1,dataType:"json",success:function(e){e&&0==e.code&&(wx.config({debug:!1,appId:e.data.appId,timestamp:e.data.timestamp,nonceStr:e.data.nonceStr,signature:e.data.signature,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:t.title,link:t.link,imgUrl:t.img}),wx.onMenuShareAppMessage({title:t.title,desc:t.desc,link:t.link,imgUrl:t.img,type:"",dataUrl:""}),wx.onMenuShareQQ({title:t.title,desc:t.desc,link:t.link,imgUrl:t.img})}),wx.error(function(e){}))},error:function(){}},e),$.ajax(e))};return{setWeiXinShareConfig:function(e){var t,a,n;i()&&(t="http://res.wx.qq.com/open/js/jweixin-1.0.0.js",a=function(){s(e)},(n=document.createElement("script")).src=t,n.type="text/javascript",a=a||function(){},n.onload=function(e){a(),this.onload=null},document.getElementsByTagName("head")[0].appendChild(n))},weixinShare:s}}(),ZMF=function(e){var t=function(){var e=[0,1,2,3,6,7],t=[],a=[];for(var n in e){var i=e[n];for(var s in e){var o=e[s];for(var c in e){var r=e[c];if(i!=o&&o!=r&&i!=r){var g=[i,o,r];g.sort();var l=g[0]+""+g[1]+g[2];-1==a.indexOf(l)&&(a.push(l),t.push(g))}}}}return t}(),i=[{name:"吃货桶",des:"没错，你就是那个万众挑一的饭桶！面对美食你向来是来着不拒，毫无抵抗力！有你在的饭局，垃圾桶的参与感为零。"},{name:"巨星桶",des:"如果生活是一个垃圾桶，你就是那个被所有回收站争抢的那个矿泉水瓶。如果生活是一场热波音乐节，你就是万人宠爱的毛不易；拥有强大气场的你走到哪都是人群中最出挑的那一个巨星。"},{name:"IQ桶",des:"小机灵鬼儿，你是团队内的智慧担当，没有你想不明白的问题，门萨俱乐部的入会测试对你来说也只是小菜一碟。真想掀起你的头盖骨…啊不是，掀起你的盖子，看看里面都装了些什么。"},{name:"摇滚桶",des:"谁说垃圾桶只能安安静静地待在角落？内心如你般热血而愤怒，任何东西都能用来表达自我！你的生活不能没有音乐，哪怕身边没有吉他，敲打敲打自己的的盖子你也能立马高歌一曲！"},{name:"逗笔桶",des:"你是所有朋友口中的小逗笔，有你的地方就有笑声！派对由你来活跃气氛准没错，你的字典里压根没有“冷场”这两个字！我们打算派你的朋友去和戴佩妮PK掐大腿了…"},{name:"桃花桶",des:"有一个神奇的传说，和你做朋友的人都会在3个月内脱单。你简直就是红娘本娘！有心无心的一直在促成朋友圈共同好友之间的一段段姻缘。截图给你的那些单身狗朋友们看吧，3个月后他们会回来感谢你的。"},{name:"飒蜜桶",des:"天啦噜~可爱滴你设计出了一个更加可爱滴垃圾桶哦！我猜你一定是个萌妹纸吧！你的可爱和那些装腔作势的绿茶们不同。不娇柔做作恰恰就是你最可爱的品质。"},{name:"颜值桶",des:"“沉鱼落雁，闭月羞花”说的就是你了！作为朋友圈中的颜值top3，你随时都在吸引异性甚至同性热情的瞩目。招蜂引蝶不是你的错，你只是将自己天生的优势发挥的游刃有余而已，果然桶如其人啊！"},{name:"魔鬼桶",des:"你拥有小恶魔般的性格，总是有些邪恶但不失可爱的小想法，比如在别人坐下的瞬间把凳子抽掉；比如偷偷的把别人的SKII换成卸妆水；比如看到这里，你想问候一下这个游戏的设计者。"},{name:"感性桶",des:"看似坚强能干的你其实拥有着柔软的内心，你总能被这个世界上一些看似不起眼的小事情和小人物打动。由于心地很善良，所以总不愿伤害别人。有时会觉得自己与其他人不一样、喜欢沉醉于自己的想象世界。"}],a=/iphone/gi.test(navigator.userAgent)&&812==screen.height&&375==screen.width;return{queue:null,copyDom:null,actorArr:[],actor_timer:null,maskTimer:null,marqueeTimer:null,userName:"",bucketName:"",animationEnd:function(e){var t={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"mozAnimationEnd",WebkitAnimation:"webkitAnimationEnd"};for(var a in t)if(void 0!==e.style[a])return t[a]}(document.createElement("div")),preLoad:function(){var a=ZMF,n=["bird_purple.png","dialog_left.gif","dialog_right.gif","lamp_light.png","lamp_light1.png","bird_red.png","page3_bg.jpg","page3_as.png","page3_dpn.png","page3_mby.png","page3_wsl.png","page3_gd.png","page3_chy.png","page3_wz2.svg","page5_bg.png","page5_bg_active.png","page5_bg_x.png","page5_bg_active_x.jpg","page6_box.png","page8_bird.png","page8_lamp.png","page9_mask.png","page9_bg.jpg"],i=0,s=!1;n.forEach(function(e){var t=new Image;t.src="image/"+e,t.onload=function(){i++,$(".loading_text").text(Math.floor(100*i/n.length)+"%"),i==n.length&&(a.bgAnimate(),s=!0)}}),setTimeout(function(){i==n.length||s||a.bgAnimate()},2e4)},loadFileProgress:function(e){$(".loading_text").text((100*this.progress|0)+"%")},bgAnimate:function(){var e=ZMF;console.log("资源全部加载完毕");var t=$(".h_bg");$(".h_loading").css("display","none"),$(".page1 img").each(function(){$(this).attr("src",$(this).attr("data-src")).removeAttr("data-src")}),t.addClass("box_enter"),$("#audioBg").attr("src",$("#audioBg").attr("data-src")).removeAttr("data-src"),setTimeout(function(){t.removeClass("box_enter").addClass("box_shake")},600),setTimeout(function(){e.pageplay(".page1")},800)},pagestart:function(e){$(e).each(function(){$(this).attr("src",$(this).attr("data-src")).removeAttr("data-src")})},pageplay:function(e){$(e).siblings().css("display","none").end().css("display","block")},marquee:function(){var e=ZMF,t=0;e.marqueeTimer=setInterval(function(){t++,$(".page5 .bg").toggleClass("active"),6==t&&(clearInterval(e.marqueeTimer),e.pagestart(".page6 img"),setTimeout(function(){e.pageplay(".page6"),a&&$(".h_foot").removeClass("active")},600))},100)},mask_square:function(){var e=ZMF,t=0,a=0;e.maskTimer=setInterval(function(){29==t?(t=0,a++):t++,2==a?t-1==e.actorArr[0].index||t-1==e.actorArr[1].index||t-1==e.actorArr[2].index?$(".page5 .mask_square span").eq(t).addClass("active"):$(".page5 .mask_square span").eq(t).addClass("active").end().eq(t-1).removeClass("active"):3==a?(clearInterval(e.maskTimer),e.marquee()):$(".page5 .mask_square span").eq(t).addClass("active").end().eq(t-1).removeClass("active")},60)},diyStart:function(e){e.preventDefault(),e.stopPropagation();var t=ZMF,a=$(this)[0].getBoundingClientRect(),n={width:a.width+"px",height:a.height+"px",left:a.left+"px",top:a.top+"px"};t.copyDom=$(this).clone().css(n).appendTo(".page7")},diyMove:function(e){e.preventDefault(),e.stopPropagation();var t=ZMF,a=e.originalEvent.targetTouches[0],n=parseInt(t.copyDom.css("width"))/2,i=parseInt(t.copyDom.css("height"))/2,s=a.pageX-n+"px",o=a.pageY-i+"px";t.copyDom.css({left:s,top:o})},diyEnd:function(e){e.preventDefault(),e.stopPropagation();var t=ZMF,a=$(".page7 .diy_left .diy_content")[0].getBoundingClientRect(),n=t.copyDom[0].getBoundingClientRect(),i=t.copyDom.attr("class"),s=a.top<=n.top,o=a.left<=n.left,c=a.right>=n.right,r=a.bottom>=n.bottom,g=parseInt(t.copyDom.css("left"))-a.left+"px",l=parseInt(t.copyDom.css("top"))-a.top+"px";t.isScale=!1,s&&o&&c&&r?($(".page7 .diy_content").children("."+i).remove(),t.copyDom.prependTo($(".page7 .diy_content")).css({left:g,top:l}),t.setScale()):t.copyDom.remove()},getDistance:function(e,t){var a=t.pageX-e.pageX,n=t.pageY-e.pageY;return Math.sqrt(a*a+n*n)},setScale:function(){var l=ZMF,e=$(".page7 .diy_left .diy_content"),p=[],d=!0;e.on("touchstart",function(e){2<=e.originalEvent.touches.length?p=e.originalEvent.touches:e.preventDefault()}),e.on("touchmove",function(e){if(d){d=!1,setTimeout(function(){d=!0},60);var t=e.originalEvent.touches;if(2<=t.length){var a=t,n=(l.getDistance(a[0],a[1])/l.getDistance(p[0],p[1])).toFixed(2);l.copyDom.css("transform","scale("+n+")")}else if(1!=t.length||"IMG"!=t[0].target.tagName||$(t[0].target).hasClass("static"))e.preventDefault();else{var i=$(t[0].target),s=$(this)[0].getBoundingClientRect(),o=parseInt(i.css("width"))/2,c=parseInt(i.css("height"))/2,r=t[0].pageX-o-s.left+"px",g=t[0].pageY-c-s.top+"px";i.css({left:r,top:g})}}})},drawCanvas:function(e,a){var t=$(e)[0],n=$(e).width(),i=$(e).height(),s=document.createElement("canvas");s.width=2*n,s.height=2*i,s.getContext("2d").scale(2,2);var o={scale:2,canvas:s,width:n,height:i,useCORS:!0};console.log(o),html2canvas(t,o).then(function(e){var t=e.getContext("2d");t.mozImageSmoothingEnabled=!1,t.webkitImageSmoothingEnabled=!1,t.msImageSmoothingEnabled=!1,t.imageSmoothingEnabled=!1,$(a).append(e)})},convert2canvas:function(e,n){var t=$(e)[0],a=$(e).width(),i=$(e).height(),s=document.createElement("canvas");s.width=2*a,s.height=2*i,s.getContext("2d").scale(2,2);var o={scale:2,canvas:s,width:a,height:i,useCORS:!0};console.log(o),html2canvas(t,o).then(function(e){var t=e.getContext("2d");t.mozImageSmoothingEnabled=!1,t.webkitImageSmoothingEnabled=!1,t.msImageSmoothingEnabled=!1,t.imageSmoothingEnabled=!1;var a=Canvas2Image.convertToPNG(e,e.width,e.height);$(n).append(a),".page9"==n?$(a).css({width:e.width/2+"px",height:e.height/2+"px"}).addClass("f-full"):$(a).addClass("f-full")})},createRandom:function(e){var a=void 0,n=[];return e.forEach(function(e){n.push(e.index)}),e.sort(function(e,t){return e-t}),t.forEach(function(e,t){e.toString()==n.toString()&&(a=Math.floor(t/2))}),a},events:function(){var n=this;$(".page1 input[type='text']").on("change",function(){$(this).val()?$(".page1 .input_box").addClass("active"):$(".page1 .input_box").removeClass("active"),$(".page2 img").each(function(){$(this).attr("src",$(this).attr("data-src")).removeAttr("data-src")}),$(".page1 .input_box").hasClass("active")?$(".page1 .go").on({touchstart:function(){$(".page2 img").each(function(){$(this).attr("src",$(this).attr("data-src")).removeAttr("data-src")})},click:function(){n.pageplay(".page2");var e=$(".page1 input").val();$(".user").text(e),n.userName=e,$("#audioBg")[0].paused&&($("#audioBg")[0].volume=.6,$("#audioBg")[0].play())}}):$(".page1 .go").off()}),$(".page3 .actor").on("click",function(){if(!(3<=$(".page3 .actor.active").length))if($(this).hasClass("active")?$(this).removeClass("active"):$(this).addClass("active"),3==$(".page3 .actor.active").length){$(".page3 .actor.active").each(function(){n.actorArr.push({index:$(this).data("index"),text:$(this).data("text")})}),$(".page3 .logo").addClass("active"),$(".page4 img").each(function(){$(this).attr("src",$(this).attr("data-src")).removeAttr("data-src")}),setTimeout(function(){n.pageplay(".page4"),$(".page3 .logo").removeClass("active"),$(".page3 .actor").removeClass("active")},1200),n.actorArr.sort(function(e,t){return e.index-t.index}),console.log(n.actorArr),$(".page6 .gift_text").each(function(e){$(this).text(n.actorArr[e].text)});var t=0,e=function(){var e=$(this).data("index");e!=n.actorArr[0].index&&e!=n.actorArr[1].index&&e!=n.actorArr[2].index||(t<3?t++:t=1,$(this).addClass("visible"+t),1==t&&$(this).addClass("active"))};$(".page7 .diy_element li").each(e).on("click",function(){var e=$(this).index();$(this).hasClass("active")||($(this).addClass("active").siblings().removeClass("active"),$(".diy_element .labels > div").eq(e).addClass("active").siblings().removeClass("active"),$(".diy_element .labels > div:eq("+e+") img").each(function(){$(this).attr("src",$(this).attr("data-src")).removeAttr("data-src")}))}),$(".page7 .diy_element .labels > div").each(e);var a=n.createRandom(n.actorArr);$(".page9 .bucket").text(i[a].name),$(".page9 .bucketDes").text(i[a].des),n.bucketName=i[a].name}else n.actorArr=[]}),$(".page4 .go").on({touchstart:function(){$(".page5 img").each(function(){$(this).attr("src",$(this).attr("data-src")).removeAttr("data-src")})},click:function(){$(".page5").siblings().css("display","none").end().css("display","block"),n.mask_square(),a&&($(".page5").addClass("iphoneX"),$(".h_foot").addClass("active"))}}),$(".page2 .go").on({touchstart:function(){$(".page3 img").each(function(){$(this).attr("src",$(this).attr("data-src")).removeAttr("data-src")})},click:function(){$(".page3").siblings().css("display","none").end().css("display","block")}}),$(".page6 .go").on({touchstart:function(){$(".page7 .diy_container img").each(function(){$(this).attr("src",$(this).attr("data-src")).removeAttr("data-src")}),$(".page7 .diy_element .labels .active img").each(function(){$(this).attr("src",$(this).attr("data-src")).removeAttr("data-src")}),$(".page7 .go img").each(function(){$(this).attr("src",$(this).attr("data-src")).removeAttr("data-src")})},click:function(){$(".page7").siblings().css("display","none").end().css("display","block"),$(".h_foot").css("display","none"),a?($(".page7 .diy_container").addClass("iphoneX"),$(".page7 .diy_element").addClass("iphoneX")):$(".page7 .diy_element").removeClass("iphoneX")}}),$(".page7 .diy_right li").on({touchstart:function(){if(!$(this).hasClass("active")){var e=$(this).index()+1,t=$(".diy_bg img").attr("src").split(".png")[0].slice(0,-1);$(".diy_bg img").attr("src",t+e+".png")}},click:function(){$(this).addClass("active").siblings().removeClass("active")}}),$(".page7 .go").on({touchstart:function(){n.convert2canvas(".page7 .diy_box",".page9 .bucket_container"),$(".page8 img").each(function(){$(this).attr("src",$(this).attr("data-src")).removeAttr("data-src")}),$(".page9 img").each(function(){$(this).attr("src",$(this).attr("data-src")).removeAttr("data-src")})},click:function(){$(".page8").siblings().css("display","none").end().css("display","block"),$(".h_foot").css("display",""),Weixin.weixinShare({title:n.userName+"竟然是一只"+n.bucketName+"看看你是一只什么桶",link:location.origin,img:location.origin+"/image/wxShare.jpeg",desc:"来看看你是什么桶!"})}}),$(".page8").on("touchstart",function(e){console.log(e.touches[0].target.className),$(".page9").siblings().css("display","none").end().css("display","block"),a&&$(".page9").addClass("iphoneX"),"go"==e.touches[0].target.className?$(".page9 .share_mask").addClass("active"):$(".page9 .share_mask").removeClass("active"),setTimeout(function(){n.convert2canvas(".page9 .container",".page9")},3e3)}),$(".page6 .take_gift .next").on("click",function(){$(".page6 .take_gift").addClass("active"),setTimeout(function(){$(".page6 .take_gift").css("display","none"),$(".page6 .make").css("display","block")},500)}),$(".page7 .labels img").on({touchstart:this.diyStart,touchmove:this.diyMove,touchend:this.diyEnd}),$(".page9 .reset").on("click",function(){$(".page1").siblings().css("display","none").end().css("display","block"),$(".page7 .diy_element .labels > div").removeAttr("class"),$(".page7 .diy_element li").removeAttr("class"),$(".page7 .diy_content .static").siblings().remove(),$(".page6 .take_gift").removeClass("active"),$(".page6 .take_gift").css("display",""),$(".page6 .make").css("display",""),$(".page5 .mask_square span").removeAttr("class"),$(".page9 > img").remove(),$(".page9 .bucket_container .f-full").remove()})},load:function(){var e=ZMF;return $(function(){$("body").height($(window).height()),$("section").on("touchmove",!1),e.preLoad(),$("section > div").on("touchstart",function(){"undefined"!=$(this).find("img").attr("data-src")&&$(this).find("img").each(function(){$(this).attr("src",$(this).attr("data-src")).removeAttr("data-src")})})}),e},init:function(){this.load().events()}}}(document);