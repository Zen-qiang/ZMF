"use strict";var ZMF=function(e){var i=[{index:0,alias:"d",gift:"还想怎样"},{index:1,alias:"m",gift:"一起喝啤酒"},{index:2,alias:"w",gift:"追光者"},{index:3,alias:"g",gift:"水星记"},{index:6,alias:"a",gift:"天府广场吃炸鸡"},{index:7,alias:"c",gift:"tets"}];return{queue:null,copyDom:null,actorArr:[],actor_timer:null,maskTimer:null,marqueeTimer:null,animationEnd:function(e){var t={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"mozAnimationEnd",WebkitAnimation:"webkitAnimationEnd"};for(var a in t)if(void 0!==e.style[a])return t[a]}(document.createElement("div")),preLoad:function(){this.queue=new createjs.LoadQueue(!1),this.queue.loadManifest([{id:"bird_purple",src:"bird_purple.png"},{id:"dialog_box",src:"dialog_box.gif"},{id:"lamp_light",src:"lamp_light.png"},{id:"dialog_box1",src:"dialog_box1.gif"},{id:"lamp_light1",src:"lamp_light1.png"},{id:"page3_bg",src:"page3_bg.jpg"},{id:"page3_as",src:"page3_as.png"},{id:"page3_dnp",src:"page3_dpn.png"},{id:"page3_mby",src:"page3_mby.png"},{id:"page3_wsl",src:"page3_wsl.png"},{id:"page3_gd",src:"page3_gd.png"},{id:"page3_chy",src:"page3_chy.png"},{id:"page3_wz1",src:"page3_wz2.svg"},{id:"page4_box",src:"page4_box.gif"},{id:"page5_bg",src:"page5_bg.png"},{id:"page5_bg_active",src:"page5_bg_active.png"},{id:"page6_box",src:"page6_box.png"},{id:"page6_text",src:"page6_text.gif"}],!0,"image/"),this.queue.on("progress",this.loadFileProgress),this.queue.on("complete",this.bgAnimate)},loadFileProgress:function(e){console.log("已加载 "+(100*this.progress|0)+"%"),$(".loading_text").text((100*this.progress|0)+"%")},bgAnimate:function(){var e=ZMF;console.log("资源全部加载完毕");var t=$(".h_bg");$(".h_loading").css("display","none"),$(".page1 img").each(function(){$(this).attr("src",$(this).attr("data-src")).removeAttr("data-src")}),t.addClass("box_enter"),setTimeout(function(){t.removeClass("box_enter").addClass("box_shake")},600),setTimeout(function(){e.pageplay(".page1")},800)},pagestart:function(e){$(e).each(function(){$(this).attr("src",$(this).attr("data-src")).removeAttr("data-src")})},pageplay:function(e){$(e).siblings().css("display","none").end().css("display","block")},marquee:function(){var e=ZMF,t=0;e.marqueeTimer=setInterval(function(){t++,$(".page5 .bg").toggleClass("active"),6==t&&(clearInterval(e.marqueeTimer),e.pagestart(".page6 img"),setTimeout(function(){e.pageplay(".page6")},600))},100)},mask_square:function(){var e=ZMF,t=0,a=0;e.maskTimer=setInterval(function(){29==t?(t=0,a++):t++,2==a?t-1==e.actorArr[0]||t-1==e.actorArr[1]||t-1==e.actorArr[2]?$(".page5 .mask_square span").eq(t).addClass("active"):$(".page5 .mask_square span").eq(t).addClass("active").end().eq(t-1).removeClass("active"):3==a?(clearInterval(e.maskTimer),e.marquee()):$(".page5 .mask_square span").eq(t).addClass("active").end().eq(t-1).removeClass("active")},60)},diyStart:function(e){e.preventDefault(),e.stopPropagation();var t=ZMF,a=$(this)[0].getBoundingClientRect(),i={width:a.width+"px",height:a.height+"px",left:a.left+"px",top:a.top+"px"};t.copyDom=$(this).clone().css(i).appendTo(".page7")},diyMove:function(e){e.preventDefault(),e.stopPropagation();var t=ZMF,a=e.originalEvent.targetTouches[0],i=parseInt(t.copyDom.css("width"))/2,n=parseInt(t.copyDom.css("height"))/2,o=a.pageX-i+"px",s=a.pageY-n+"px";t.copyDom.css({left:o,top:s})},diyEnd:function(e){e.preventDefault(),e.stopPropagation();var t=ZMF,a=$(".page7 .diy_left .diy_content")[0].getBoundingClientRect(),i=t.copyDom[0].getBoundingClientRect(),n=t.copyDom.attr("class"),o=a.top<=i.top,s=a.left<=i.left,c=a.right>=i.right,r=a.bottom>=i.bottom,g=parseInt(t.copyDom.css("left"))-a.left+"px",p=parseInt(t.copyDom.css("top"))-a.top+"px";t.isScale=!1,o&&s&&c&&r?($(".page7 .diy_content").children("."+n).remove(),t.copyDom.prependTo($(".page7 .diy_content")).css({left:g,top:p}),t.setScale()):t.copyDom.remove()},getDistance:function(e,t){var a=t.pageX-e.pageX,i=t.pageY-e.pageY;return Math.sqrt(a*a+i*i)},setScale:function(){var p=ZMF,e=$(".page7 .diy_left .diy_content"),l=[],d=!0;e.on("touchstart",function(e){2<=e.originalEvent.touches.length?l=e.originalEvent.touches:e.preventDefault()}),e.on("touchmove",function(e){if(d){d=!1,setTimeout(function(){d=!0},60);var t=e.originalEvent.touches;if(2<=t.length){var a=t,i=(p.getDistance(a[0],a[1])/p.getDistance(l[0],l[1])).toFixed(2);p.copyDom.css("transform","scale("+i+")")}else if(1!=t.length||"IMG"!=t[0].target.tagName||$(t[0].target).hasClass("static"))e.preventDefault();else{var n=$(t[0].target),o=$(this)[0].getBoundingClientRect(),s=parseInt(n.css("width"))/2,c=parseInt(n.css("height"))/2,r=t[0].pageX-s-o.left+"px",g=t[0].pageY-c-o.top+"px";n.css({left:r,top:g})}}})},convert2canvas:function(){var e=$(".page9 .container")[0],t=$(".page9 .container").width(),a=$(".page9 .container").height(),i=document.createElement("canvas");i.width=2*t,i.height=2*a,i.getContext("2d").scale(2,2);var n={scale:2,canvas:i,width:t,height:a,useCORS:!0};console.log(n),html2canvas(e,n).then(function(e){var t=e.getContext("2d");t.mozImageSmoothingEnabled=!1,t.webkitImageSmoothingEnabled=!1,t.msImageSmoothingEnabled=!1,t.imageSmoothingEnabled=!1;var a=Canvas2Image.convertToPNG(e,e.width,e.height);$(".page9").append(a),$(a).css({width:e.width/2+"px",height:e.height/2+"px"}).addClass("f-full")})},createRandom:function(){},events:function(){for(var a=this,t=1;t<=9;t++)1==t&&$(".page1 input[type='text']").on("change",function(){$(this).val()?$(".page1 .input_box").addClass("active"):$(".page1 .input_box").removeClass("active"),$(".page1 .input_box").hasClass("active")?$(".page1 .go").on({touchstart:function(){$(".page2 img").each(function(){$(this).attr("src",$(this).attr("data-src")).removeAttr("data-src")})},click:function(){a.pageplay(".page2");var e=$(".page1 input").val();$(".user").text(e)}}):$(".page1 .go").off()}),3==t&&$(".page3 .actor").on("click",function(){if(!(3<=$(".page3 .actor.active").length)&&($(this).hasClass("active")?$(this).removeClass("active"):$(this).addClass("active"),3==$(".page3 .actor.active").length)){$(".page3 .actor.active").each(function(){a.actorArr.push($(this).data("index"))}),$(".page3 .logo").addClass("active"),$(".page4 img").each(function(){$(this).attr("src",$(this).attr("data-src")).removeAttr("data-src")}),setTimeout(function(){a.pageplay(".page4"),$(".page3 .logo").removeClass("active"),$(".page3 .actor").removeClass("active")},1200),console.log(a.actorArr);i.forEach(function(e){if(e.index==a.actorArr[0]||e.index==a.actorArr[1]||e.index==a.actorArr[2]){"<div>";for(var t=1;t<=4;t++)"<p><img class='"+e.alias+t+"' data-src='image/"+e.alias+"_label"+t+".png'></p>";"</div>"}}),$(".page7 .diy_element .labels").before()}}),4==t?$(".page4 .go").on({touchstart:function(){$(".page5 img").each(function(){$(this).attr("src",$(this).attr("data-src")).removeAttr("data-src")})},click:function(){$(".page5").siblings().css("display","none").end().css("display","block"),a.mask_square()}}):function(){var e=t+1;$(".page"+t+" .go").on({touchstart:function(){$(".page"+e+" img").each(function(){$(this).attr("src",$(this).attr("data-src")).removeAttr("data-src")})},click:function(){$(".page"+e).siblings().css("display","none").end().css("display","block")}})}();$(".page6 .take_gift .next").on("click",function(){$(".page6 .take_gift").addClass("active"),setTimeout(function(){$(".page6 .take_gift").css("display","none"),$(".page6 .make").css("display","block")},500)}),$(".page7 .labels img").on({touchstart:this.diyStart,touchmove:this.diyMove,touchend:this.diyEnd})},load:function(){var e=ZMF;return $(function(){$("body").height($(window).height()),$("section").on("touchmove",!1),e.preLoad()}),e},init:function(){this.load().events()}}}(document);